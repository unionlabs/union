name: Build

on:
  push:
    branches:
    - main
  pull_request:
    branches:
    - main


concurrency:
  group: ${{ github.workflow }}-${{ github.event.pull_request.number || github.sha }}
  cancel-in-progress: true

jobs:
  build:
    uses: unionlabs/workflows/.github/workflows/build.yml@2c94f6f3acb2d7d9222f8fa05f43eb8c3ed2e758
    secrets:
      nixbuild_token: ${{ secrets.nixbuild_token }}
      access-tokens: github.com=${{ secrets.GITHUB_TOKEN }}
    with:
      filter_builds: '((.top_attr == "checks" or .top_attr == "packages" or .top_attr == "devShells") and (.system == "x86_64-linux" or .system == "aarch64-linux") and (.attr != "bundle-mainnet" and .attr != "bundle-testnet" and .attr != "generate-evm-proto" and .attr != "generate-prover-proto" and .attr != "gen-proto" and .attr != "pre-commit-check" and .attr != "pre-commit" and .attr != "devnet" and .attr != "devnet-cosmos" and .attr != "devnet-evm" and .attr != "rust-proto" and .attr != "generate-rust-proto" and .attr != "go-vendor" and .attr != "evm-contracts" and .attr != "virtualisation-works" and .attr != "ensure-blocks" and .attr != "union-runs" and .attr != "sepolia-runs") or (.attr == "evm-contracts" and .system == "x86_64-linux") or (.attr == "devnet" and .system == "x86_64-linux") or (.attr == "devnet-cosmos" and .system == "x86_64-linux") or (.attr == "devnet-evm" and .system == "x86_64-linux") or (.attr == "virtualisation-works" and .system == "x86_64-linux"))'
 
