<script lang="ts">
  import clsx from 'clsx'
  import { Button } from 'bits-ui'
  import { snapAddress } from '$/lib/snap.ts'
  import { getUnoFromFaucet } from '$/lib/fetchers/faucet'
  import { createMutation, useQueryClient } from '@tanstack/svelte-query'

  const queryClient = useQueryClient()

  const unoFromFaucetMutation = createMutation({
    mutationFn: async () => {
      if (!$snapAddress) return
      return await getUnoFromFaucet({ address: $snapAddress })
    },
    onSuccess: () =>
      Promise.all([
        queryClient.invalidateQueries({ queryKey: ['balance-sepolia-uno'] }),
        queryClient.invalidateQueries({ queryKey: ['balance-union-uno'] })
      ])
  })
</script>

<Button.Root
  class={clsx('rounded-md border-[1px] px-4 py-2')}
  on:click={() => {
    if (!$snapAddress) return
    $unoFromFaucetMutation.mutate()
  }}
>
  get UNO from faucet
</Button.Root>
