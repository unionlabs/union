<!-- @migration-task Error while migrating Svelte code: can't migrate `$: live = $timestamp === null` to `$derived` because there's a variable named derived.
     Rename the variable and try again or migrate by hand. -->
<!-- @migration-task Error while migrating Svelte code: can't migrate `$: live = $timestamp === null` to `$derived` because there's a variable named derived.
     Rename the variable and try again or migrate by hand. -->
<!-- @migration-task Error while migrating Svelte code: can't migrate `$: live = $timestamp === null` to `$derived` because there's a variable named derived.
     Rename the variable and try again or migrate by hand. -->
<!-- @migration-task Error while migrating Svelte code: can't migrate `$: live = $timestamp === null` to `$derived` because there's a variable named derived.
     Rename the variable and try again or migrate by hand. -->
<script lang="ts">
import { cn } from "$lib/utilities/shadcn.ts"
import { Label } from "$lib/components/ui/label"
import ChevronLeft from "virtual:icons/lucide/chevron-left"
import Button from "$lib/components/ui/button/button.svelte"
import ChevronRight from "virtual:icons/lucide/chevron-right"
import { derived, type Readable } from "svelte/store"
import { toast } from "svelte-sonner"
import { encodeTimestampSearchParam, decodeTimestampSearchParam } from "$lib/timestamps"
import { goto } from "$app/navigation"
import { page } from "$app/stores"
import { timestamp } from "$lib/stores/page.ts"

export let explorerItems: Readable<Array<{ timestamp: any }>>
$: live = $timestamp === null

const onOlderPage = () => {
  const stamp = $explorerItems.at(-1)?.timestamp
  if (!stamp) return toast.error("Invalid older timestamp")

  goto(encodeTimestampSearchParam(stamp), {
    replaceState: true,
    state: { timestamp: stamp }
  })
}

const onNewerPage = () => {
  const stamp = $explorerItems.at(0)?.timestamp
  if (!stamp) return toast.error("Invalid newer timestamp")

  goto(encodeTimestampSearchParam(stamp), {
    replaceState: true,
    state: { timestamp: stamp }
  })
}

const onCurrentClick = () => {
  goto($page.url.pathname, { replaceState: true })
}
</script>

<div class="flex items-center gap-4 mt-4">
  <Button
    size="sm"
    variant="default"
    onclick={onCurrentClick}
    disabled={live}
    title={live ? "Already on the newest page" : "Go to the first page"}
  >
    {live ? "live" : "current"}
  </Button>
  {#if $timestamp}
    <Button
      size="sm"
      variant="secondary"
      title={live ? "Already on the newest page" : "Go to the previous page"}
      onclick={onNewerPage}
      class="pl-2"
    >
      <ChevronLeft class="size-6" />
      Newer
    </Button>
    <time class="font-normal text-sm font-mono">{$timestamp}</time>
  {/if}
  <Button
    size="sm"
    variant="secondary"
    onclick={onOlderPage}
    class="pr-2"
  >
    Older
    <ChevronRight class="size-6" />
  </Button>
</div>
