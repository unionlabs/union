import { assert, describe, it } from "@effect/vitest"
import { Effect } from "effect"

import * as WasmTest from "@unionlabs/sdk/WasmTest"

describe("WasmTest", () => {
  it.layer(WasmTest.WasmTest.Default(new URL("http://app.union.build")))((it) => {
    it.effect("loads", () =>
      Effect.gen(function*() {
        const wasm = yield* WasmTest.WasmTest

        yield* Effect.log({ tag: wasm._tag })

        console.log(wasm.wasm)

        const raw =
          "e65e37cf96c05440d66cd14602dd76959247c2bdcb2aec1f8ab77f07cbc80d270000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000002c00000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000014000000000000000000000000000000000000000000000000000000000000001800000000000000000000000000000000000000000000000056bc75e2d6310000000000000000000000000000000000000000000000000000000000000000001c00000000000000000000000000000000000000000000000056bc75e2d63100000000000000000000000000000000000000000000000000000000000000000000300000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000014e5c9489edb62ab30c1822d12872ac6ae406713910000000000000000000000000000000000000000000000000000000000000000000000000000000000000014e5c9489edb62ab30c1822d12872ac6ae406713910000000000000000000000000000000000000000000000000000000000000000000000000000000000000014ba5ed44733953d79717f6269357c77718c8ba5ed0000000000000000000000000000000000000000000000000000000000000000000000000000000000000014ba5ed44733953d79717f6269357c77718c8ba5ed00000000000000000000000000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000014ba5ed44733953d79717f6269357c77718c8ba5ed0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"

        const buf = Uint8Array.from(Buffer.from(raw, "hex"))

        const result = yield* wasm.decodePacket(buf)

        console.log(JSON.stringify(result, null, 2))

        assert.deepStrictEqual(wasm._tag, "WasmTest")
      }))
  })
})
